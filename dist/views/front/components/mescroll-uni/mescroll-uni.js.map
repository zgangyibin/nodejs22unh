{"version":3,"sources":["../../../../../src/views/front/components/mescroll-uni/mescroll-uni.js"],"names":["MeScroll","options","me","version","isDownScrolling","isUpScrolling","hasDownCallback","down","callback","initDownScroll","initUpScroll","setTimeout","optDown","use","auto","autoShowLoading","triggerDownScroll","optUp","isUpAutoLoad","triggerUpScroll","prototype","extendDownScroll","extend","isLock","offset","startTop","fps","inOffsetRate","outOffsetRate","bottomOffset","minAngle","textInOffset","textOutOffset","textLoading","inited","inOffset","outOffset","onMoving","beforeLoading","showLoading","afterLoading","endDownScroll","mescroll","resetUpScroll","extendUpScroll","isBoth","isBounce","page","num","size","time","noMoreSize","textNoMore","showNoMore","hideUpScroll","toTop","src","duration","btnClick","onShow","empty","icon","tip","btnText","onScroll","userOption","defaultOption","key","def","downHight","touchstartEvent","e","startPoint","getPoint","getScrollTop","lastPoint","maxTouchmoveY","getBodyHeight","inTouchend","touchmoveEvent","t","Date","getTime","moveTime","moveTimeDiff","scrollTop","curPoint","moveY","y","x","Math","abs","z","sqrt","angle","asin","PI","touchendEvent","preventDefault","diff","movetype","isMoveDown","round","rate","isScrollUp","touches","pageX","pageY","changedTouches","clientX","clientY","showDownScroll","endScroll","setScrollHeight","delay","lockDownScroll","up","setBounce","hasNext","startNum","scroll","setScrollTop","scrollHeight","preScrollY","showTopBtn","hideTopBtn","isCheck","canUp","getScrollBottom","showUpScroll","endUpScroll","isShowNoMore","isShowLoading","prePageNum","prePageTime","removeEmpty","setPageNum","setPageSize","endByPage","dataSize","totalPage","systime","endSuccess","endBySize","totalSize","loadSize","pageNum","pageSize","showEmpty","allDataSize","endErr","topBtnShow","scrollTo","myScrollTo","resetScrollTo","getScrollHeight","getClientHeight","getStep","star","end","count","step","i","timer","setInterval","clearInterval","isReal","h","clientHeight","setClientHeight","bodyHeight","setBodyHeight","cancelable","defaultPrevented","uniPageDom","document","getElementsByTagName","setAttribute","window","isSetBounce","bounceTouchmove","el","target","isPrevent","body","tagName","getAttribute","cls","classList","contains","curX","curY","preWinX","preWinY","parentNode","addEventListener","passive","removeEventListener"],"mappings":"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","file":"mescroll-uni.js","sourcesContent":["/* mescroll-uni\r\n * version 1.1.8\r\n * 2019-11-01 wenju\r\n * http://www.mescroll.com\r\n */\r\n\r\nexport default function MeScroll(options) {\r\n\tlet me = this;\r\n\tme.version = '1.1.8'; // mescroll版本号\r\n\tme.options = options || {}; // 配置\r\n\r\n\tme.isDownScrolling = false; // 是否在执行下拉刷新的回调\r\n\tme.isUpScrolling = false; // 是否在执行上拉加载的回调\r\n\tlet hasDownCallback = me.options.down && me.options.down.callback; // 是否配置了down的callback\r\n\r\n\t// 初始化下拉刷新\r\n\tme.initDownScroll();\r\n\t// 初始化上拉加载,则初始化\r\n\tme.initUpScroll();\r\n\r\n\t// 自动加载\r\n\tsetTimeout(function() { // 待主线程执行完毕再执行,避免new MeScroll未初始化,在回调获取不到mescroll的实例\r\n\t\t// 自动触发下拉刷新 (只有配置了down的callback才自动触发下拉刷新)\r\n\t\tif (me.optDown.use && me.optDown.auto && hasDownCallback) {\r\n\t\t\tif (me.optDown.autoShowLoading) {\r\n\t\t\t\tme.triggerDownScroll(); // 显示下拉进度,执行下拉回调\r\n\t\t\t} else {\r\n\t\t\t\tme.optDown.callback && me.optDown.callback(me); // 不显示下拉进度,直接执行下拉回调\r\n\t\t\t}\r\n\t\t}\r\n\t\t// 自动触发上拉加载\r\n\t\tme.optUp.use && me.optUp.auto && !me.isUpAutoLoad && me.triggerUpScroll();\r\n\t}, 30); // 需让me.optDown.inited和me.optUp.inited先执行\r\n}\r\n\r\n/* 配置参数:下拉刷新 */\r\nMeScroll.prototype.extendDownScroll = function(optDown) {\r\n\t// 下拉刷新的配置\r\n\tMeScroll.extend(optDown, {\r\n\t\tuse: true, // 是否启用下拉刷新; 默认true\r\n\t\tauto: true, // 是否在初始化完毕之后自动执行下拉刷新的回调; 默认true\r\n\t\tautoShowLoading: false, // 如果设置auto=true(在初始化完毕之后自动执行下拉刷新的回调),那么是否显示下拉刷新的进度; 默认false\r\n\t\tisLock: false, // 是否锁定下拉刷新,默认false;\r\n\t\toffset: 80, // 在列表顶部,下拉大于80px,松手即可触发下拉刷新的回调\r\n\t\tstartTop: 100, // scroll-view滚动到顶部时,此时的scroll-top不一定为0, 此值用于控制最大的误差\r\n\t\tfps: 40, // 下拉节流 (值越大每秒刷新频率越高)\r\n\t\tinOffsetRate: 1, // 在列表顶部,下拉的距离小于offset时,改变下拉区域高度比例;值小于1且越接近0,高度变化越小,表现为越往下越难拉\r\n\t\toutOffsetRate: 0.2, // 在列表顶部,下拉的距离大于offset时,改变下拉区域高度比例;值小于1且越接近0,高度变化越小,表现为越往下越难拉\r\n\t\tbottomOffset: 20, // 当手指touchmove位置在距离body底部20px范围内的时候结束上拉刷新,避免Webview嵌套导致touchend事件不执行\r\n\t\tminAngle: 45, // 向下滑动最少偏移的角度,取值区间  [0,90];默认45度,即向下滑动的角度大于45度则触发下拉;而小于45度,将不触发下拉,避免与左右滑动的轮播等组件冲突;\r\n\t\ttextInOffset: '下拉刷新', // 下拉的距离在offset范围内的提示文本\r\n\t\ttextOutOffset: '释放更新', // 下拉的距离大于offset范围的提示文本\r\n\t\ttextLoading: '加载中 ...', // 加载中的提示文本\r\n\t\tinited: null, // 下拉刷新初始化完毕的回调\r\n\t\tinOffset: null, // 下拉的距离进入offset范围内那一刻的回调\r\n\t\toutOffset: null, // 下拉的距离大于offset那一刻的回调\r\n\t\tonMoving: null, // 下拉过程中的回调,滑动过程一直在执行; rate下拉区域当前高度与指定距离的比值(inOffset: rate<1; outOffset: rate>=1); downHight当前下拉区域的高度\r\n\t\tbeforeLoading: null, // 准备触发下拉刷新的回调: 如果return true,将不触发showLoading和callback回调; 常用来完全自定义下拉刷新, 参考案例【淘宝 v6.8.0】\r\n\t\tshowLoading: null, // 显示下拉刷新进度的回调\r\n\t\tafterLoading: null, // 准备结束下拉的回调. 返回结束下拉的延时执行时间,默认0ms; 常用于结束下拉之前再显示另外一小段动画,才去隐藏下拉刷新的场景, 参考案例【dotJump】\r\n\t\tendDownScroll: null, // 结束下拉刷新的回调\r\n\t\tcallback: function(mescroll) {\r\n\t\t\t// 下拉刷新的回调;默认重置上拉加载列表为第一页\r\n\t\t\tmescroll.resetUpScroll();\r\n\t\t}\r\n\t})\r\n}\r\n\r\n/* 配置参数:上拉加载 */\r\nMeScroll.prototype.extendUpScroll = function(optUp) {\r\n\t// 上拉加载的配置\r\n\tMeScroll.extend(optUp, {\r\n\t\tuse: true, // 是否启用上拉加载; 默认true\r\n\t\tauto: true, // 是否在初始化完毕之后自动执行上拉加载的回调; 默认true\r\n\t\tisLock: false, // 是否锁定上拉加载,默认false;\r\n\t\tisBoth: true, // 上拉加载时,如果滑动到列表顶部是否可以同时触发下拉刷新;默认true,两者可同时触发;\r\n\t\tisBounce: false, // 默认禁止橡皮筋的回弹效果, 必读事项: http://www.mescroll.com/qa.html?v=190725#q25\r\n\t\tcallback: null, // 上拉加载的回调;function(page,mescroll){ }\r\n\t\tpage: {\r\n\t\t\tnum: 0, // 当前页码,默认0,回调之前会加1,即callback(page)会从1开始\r\n\t\t\tsize: 10, // 每页数据的数量\r\n\t\t\ttime: null // 加载第一页数据服务器返回的时间; 防止用户翻页时,后台新增了数据从而导致下一页数据重复;\r\n\t\t},\r\n\t\tnoMoreSize: 5, // 如果列表已无数据,可设置列表的总数量要大于等于5条才显示无更多数据;避免列表数据过少(比如只有一条数据),显示无更多数据会不好看\r\n\t\toffset: 80, // 距底部多远时,触发upCallback\r\n\t\ttextLoading: '加载中 ...', // 加载中的提示文本\r\n\t\ttextNoMore: '-- END --', // 没有更多数据的提示文本\r\n\t\tinited: null, // 初始化完毕的回调\r\n\t\tshowLoading: null, // 显示加载中的回调\r\n\t\tshowNoMore: null, // 显示无更多数据的回调\r\n\t\thideUpScroll: null, // 隐藏上拉加载的回调\r\n\t\ttoTop: {\r\n\t\t\t// 回到顶部按钮,需配置src才显示\r\n\t\t\tsrc: null, // 图片路径,默认null (建议写成网络图,不必考虑相对路径)\r\n\t\t\toffset: 1000, // 列表滚动多少距离才显示回到顶部按钮,默认1000\r\n\t\t\tduration: 300, // 回到顶部的动画时长,默认300ms\r\n\t\t\tbtnClick: null, // 点击按钮的回调\r\n\t\t\tonShow: null // 是否显示的回调\r\n\t\t},\r\n\t\tempty: {\r\n\t\t\tuse: true, // 是否显示空布局\r\n\t\t\ticon: null, // 图标路径\r\n\t\t\ttip: '~ 暂无相关数据 ~', // 提示\r\n\t\t\tbtnText: '', // 按钮\r\n\t\t\tbtnClick: null, // 点击按钮的回调\r\n\t\t\tonShow: null // 是否显示的回调\r\n\t\t},\r\n\t\tonScroll: false // 是否监听滚动事件\r\n\t})\r\n}\r\n\r\n/* 配置参数 */\r\nMeScroll.extend = function(userOption, defaultOption) {\r\n\tif (!userOption) return defaultOption;\r\n\tfor (let key in defaultOption) {\r\n\t\tif (userOption[key] == null) {\r\n\t\t\tlet def = defaultOption[key];\r\n\t\t\tif (def != null && typeof def === 'object') {\r\n\t\t\t\tuserOption[key] = MeScroll.extend({}, def); // 深度匹配\r\n\t\t\t} else {\r\n\t\t\t\tuserOption[key] = def;\r\n\t\t\t}\r\n\t\t} else if (typeof userOption[key] === 'object') {\r\n\t\t\tMeScroll.extend(userOption[key], defaultOption[key]); // 深度匹配\r\n\t\t}\r\n\t}\r\n\treturn userOption;\r\n}\r\n\r\n/* -------初始化下拉刷新------- */\r\nMeScroll.prototype.initDownScroll = function() {\r\n\tlet me = this;\r\n\t// 配置参数\r\n\tme.optDown = me.options.down || {};\r\n\tme.extendDownScroll(me.optDown);\r\n\r\n\tme.downHight = 0; // 下拉区域的高度\r\n\r\n\t// 在页面中加入下拉布局\r\n\tif (me.optDown.use && me.optDown.inited) {\r\n\t\t// 初始化完毕的回调\r\n\t\tsetTimeout(function() { // 待主线程执行完毕再执行,避免new MeScroll未初始化,在回调获取不到mescroll的实例\r\n\t\t\tme.optDown.inited(me);\r\n\t\t}, 0)\r\n\t}\r\n}\r\n\r\n/* 列表touchstart事件 */\r\nMeScroll.prototype.touchstartEvent = function(e) {\r\n\tif (!this.optDown.use) return;\r\n\r\n\tthis.startPoint = this.getPoint(e); // 记录起点\r\n\tthis.startTop = this.getScrollTop(); // 记录此时的滚动条位置\r\n\tthis.lastPoint = this.startPoint; // 重置上次move的点\r\n\tthis.maxTouchmoveY = this.getBodyHeight() - this.optDown.bottomOffset; // 手指触摸的最大范围(写在touchstart避免body获取高度为0的情况)\r\n\tthis.inTouchend = false; // 标记不是touchend\r\n}\r\n\r\n/* 列表touchmove事件 */\r\nMeScroll.prototype.touchmoveEvent = function(e) {\r\n\tif (!this.optDown.use) return;\r\n\tif (!this.startPoint) return;\r\n\tlet me = this;\r\n\r\n\t// 节流\r\n\tlet t = new Date().getTime();\r\n\tif (me.moveTime && t - me.moveTime < me.moveTimeDiff) { // 小于节流时间,则不处理\r\n\t\treturn;\r\n\t} else {\r\n\t\tme.moveTime = t\r\n\t\tme.moveTimeDiff = 1000 / me.optDown.fps\r\n\t}\r\n\r\n\tlet scrollTop = me.getScrollTop(); // 当前滚动条的距离\r\n\tlet curPoint = me.getPoint(e); // 当前点\r\n\r\n\tlet moveY = curPoint.y - me.startPoint.y; // 和起点比,移动的距离,大于0向下拉,小于0向上拉\r\n\r\n\t// (向下拉&&在顶部) scroll-view在滚动时不会触发touchmove,当触顶/底/左/右时,才会触发touchmove\r\n\t// scroll-view滚动到顶部时,scrollTop不一定为0; 在iOS的APP中scrollTop可能为负数,不一定和startTop相等\r\n\tif (moveY > 0 && (scrollTop <= 0 || (scrollTop <= me.optDown.startTop && scrollTop === me.startTop))) {\r\n\t\t// 可下拉的条件\r\n\t\tif (me.optDown.use && !me.inTouchend && !me.isDownScrolling && !me.optDown.isLock && (!me.isUpScrolling || (me.isUpScrolling &&\r\n\t\t\t\tme.optUp.isBoth))) {\r\n\r\n\t\t\t// 下拉的角度是否在配置的范围内\r\n\t\t\tlet x = Math.abs(me.lastPoint.x - curPoint.x);\r\n\t\t\tlet y = Math.abs(me.lastPoint.y - curPoint.y);\r\n\t\t\tlet z = Math.sqrt(x * x + y * y);\r\n\t\t\tif (z !== 0) {\r\n\t\t\t\tlet angle = Math.asin(y / z) / Math.PI * 180; // 两点之间的角度,区间 [0,90]\r\n\t\t\t\tif (angle < me.optDown.minAngle) return; // 如果小于配置的角度,则不往下执行下拉刷新\r\n\t\t\t}\r\n\r\n\t\t\t// 如果手指的位置超过配置的距离,则提前结束下拉,避免Webview嵌套导致touchend无法触发\r\n\t\t\tif (me.maxTouchmoveY > 0 && curPoint.y >= me.maxTouchmoveY) {\r\n\t\t\t\tme.inTouchend = true; // 标记执行touchend\r\n\t\t\t\tme.touchendEvent(); // 提前触发touchend\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tme.preventDefault(e); // 阻止默认事件\r\n\r\n\t\t\tlet diff = curPoint.y - me.lastPoint.y; // 和上次比,移动的距离 (大于0向下,小于0向上)\r\n\r\n\t\t\t// 下拉距离  < 指定距离\r\n\t\t\tif (me.downHight < me.optDown.offset) {\r\n\t\t\t\tif (me.movetype !== 1) {\r\n\t\t\t\t\tme.movetype = 1; // 加入标记,保证只执行一次\r\n\t\t\t\t\tme.optDown.inOffset && me.optDown.inOffset(me); // 进入指定距离范围内那一刻的回调,只执行一次\r\n\t\t\t\t\tme.isMoveDown = true; // 标记下拉区域高度改变,在touchend重置回来\r\n\t\t\t\t}\r\n\t\t\t\tme.downHight += diff * me.optDown.inOffsetRate; // 越往下,高度变化越小\r\n\r\n\t\t\t\t// 指定距离  <= 下拉距离\r\n\t\t\t} else {\r\n\t\t\t\tif (me.movetype !== 2) {\r\n\t\t\t\t\tme.movetype = 2; // 加入标记,保证只执行一次\r\n\t\t\t\t\tme.optDown.outOffset && me.optDown.outOffset(me); // 下拉超过指定距离那一刻的回调,只执行一次\r\n\t\t\t\t\tme.isMoveDown = true; // 标记下拉区域高度改变,在touchend重置回来\r\n\t\t\t\t}\r\n\t\t\t\tif (diff > 0) { // 向下拉\r\n\t\t\t\t\tme.downHight += Math.round(diff * me.optDown.outOffsetRate); // 越往下,高度变化越小\r\n\t\t\t\t} else { // 向上收\r\n\t\t\t\t\tme.downHight += diff; // 向上收回高度,则向上滑多少收多少高度\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tlet rate = me.downHight / me.optDown.offset; // 下拉区域当前高度与指定距离的比值\r\n\t\t\tme.optDown.onMoving && me.optDown.onMoving(me, rate, me.downHight); // 下拉过程中的回调,一直在执行\r\n\t\t}\r\n\t}\r\n\r\n\tme.lastPoint = curPoint; // 记录本次移动的点\r\n}\r\n\r\n/* 列表touchend事件 */\r\nMeScroll.prototype.touchendEvent = function(e) {\r\n\tif (!this.optDown.use) return;\r\n\t// 如果下拉区域高度已改变,则需重置回来\r\n\tif (this.isMoveDown) {\r\n\t\tif (this.downHight >= this.optDown.offset) {\r\n\t\t\t// 符合触发刷新的条件\r\n\t\t\tthis.triggerDownScroll();\r\n\t\t} else {\r\n\t\t\t// 不符合的话 则重置\r\n\t\t\tthis.downHight = 0;\r\n\t\t\tthis.optDown.endDownScroll && this.optDown.endDownScroll(this);\r\n\t\t}\r\n\t\tthis.movetype = 0;\r\n\t\tthis.isMoveDown = false;\r\n\t} else if (this.getScrollTop() === this.startTop) { // 到顶/左/右/底的滑动事件\r\n\t\tlet isScrollUp = this.getPoint(e).y - this.startPoint.y < 0; // 和起点比,移动的距离,大于0向下拉,小于0向上拉\r\n\t\t// 上滑 && 检查并触发上拉\r\n\t\tisScrollUp && this.triggerUpScroll(true);\r\n\t}\r\n}\r\n\r\n/* 根据点击滑动事件获取第一个手指的坐标 */\r\nMeScroll.prototype.getPoint = function(e) {\r\n\tif (!e) {\r\n\t\treturn {\r\n\t\t\tx: 0,\r\n\t\t\ty: 0\r\n\t\t}\r\n\t}\r\n\tif (e.touches && e.touches[0]) {\r\n\t\treturn {\r\n\t\t\tx: e.touches[0].pageX,\r\n\t\t\ty: e.touches[0].pageY\r\n\t\t}\r\n\t} else if (e.changedTouches && e.changedTouches[0]) {\r\n\t\treturn {\r\n\t\t\tx: e.changedTouches[0].pageX,\r\n\t\t\ty: e.changedTouches[0].pageY\r\n\t\t}\r\n\t} else {\r\n\t\treturn {\r\n\t\t\tx: e.clientX,\r\n\t\t\ty: e.clientY\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/* 触发下拉刷新 */\r\nMeScroll.prototype.triggerDownScroll = function() {\r\n\tif (this.optDown.beforeLoading && this.optDown.beforeLoading(this)) {\r\n\t\t//return true则处于完全自定义状态\r\n\t} else {\r\n\t\tthis.showDownScroll(); // 下拉刷新中...\r\n\t\tthis.optDown.callback && this.optDown.callback(this); // 执行回调,联网加载数据\r\n\t}\r\n}\r\n\r\n/* 显示下拉进度布局 */\r\nMeScroll.prototype.showDownScroll = function() {\r\n\tthis.isDownScrolling = true; // 标记下拉中\r\n\tthis.downHight = this.optDown.offset; // 更新下拉区域高度\r\n\tthis.optDown.showLoading(this, this.downHight); // 下拉刷新中...\r\n}\r\n\r\n/* 结束下拉刷新 */\r\nMeScroll.prototype.endDownScroll = function() {\r\n\tlet me = this;\r\n\t// 结束下拉刷新的方法\r\n\tlet endScroll = function() {\r\n\t\tme.downHight = 0;\r\n\t\tme.isDownScrolling = false;\r\n\t\tme.optDown.endDownScroll && me.optDown.endDownScroll(me);\r\n\t\tme.setScrollHeight(0) // 重置滚动区域,使数据不满屏时仍可检查触发翻页\r\n\t}\r\n\t// 结束下拉刷新时的回调\r\n\tlet delay = 0;\r\n\tif (me.optDown.afterLoading) delay = me.optDown.afterLoading(me); // 结束下拉刷新的延时,单位ms\r\n\tif (typeof delay === 'number' && delay > 0) {\r\n\t\tsetTimeout(endScroll, delay);\r\n\t} else {\r\n\t\tendScroll();\r\n\t}\r\n}\r\n\r\n/* 锁定下拉刷新:isLock=ture,null锁定;isLock=false解锁 */\r\nMeScroll.prototype.lockDownScroll = function(isLock) {\r\n\tif (isLock == null) isLock = true;\r\n\tthis.optDown.isLock = isLock;\r\n}\r\n\r\n/* -------初始化上拉加载------- */\r\nMeScroll.prototype.initUpScroll = function() {\r\n\tlet me = this;\r\n\t// 配置参数\r\n\tme.optUp = me.options.up || {\r\n\t\tuse: false\r\n\t};\r\n\tme.extendUpScroll(me.optUp);\r\n\r\n\tif (!me.optUp.isBounce) me.setBounce(false); // 不允许bounce时,需禁止window的touchmove事件\r\n\r\n\tif (me.optUp.use === false) return; // 配置不使用上拉加载时,则不初始化上拉布局\r\n\tme.optUp.hasNext = true; // 如果使用上拉,则默认有下一页\r\n\tme.startNum = me.optUp.page.num + 1; // 记录page开始的页码\r\n\r\n\t// 初始化完毕的回调\r\n\tif (me.optUp.inited) {\r\n\t\tsetTimeout(function() { // 待主线程执行完毕再执行,避免new MeScroll未初始化,在回调获取不到mescroll的实例\r\n\t\t\tme.optUp.inited(me);\r\n\t\t}, 0)\r\n\t}\r\n}\r\n\r\n/*列表滚动事件*/\r\nMeScroll.prototype.scroll = function(e, onScroll) {\r\n\t// 更新滚动条的位置\r\n\tthis.setScrollTop(e.scrollTop);\r\n\t// 更新滚动内容高度\r\n\tthis.setScrollHeight(e.scrollHeight);\r\n\r\n\t// 向上滑还是向下滑动\r\n\tif (this.preScrollY == null) this.preScrollY = 0;\r\n\tthis.isScrollUp = e.scrollTop - this.preScrollY > 0;\r\n\tthis.preScrollY = e.scrollTop;\r\n\r\n\t// 上滑 && 检查并触发上拉\r\n\tthis.isScrollUp && this.triggerUpScroll(true);\r\n\r\n\t// 顶部按钮的显示隐藏\r\n\tif (e.scrollTop >= this.optUp.toTop.offset) {\r\n\t\tthis.showTopBtn();\r\n\t} else {\r\n\t\tthis.hideTopBtn();\r\n\t}\r\n\r\n\t// 滑动监听\r\n\tthis.optUp.onScroll && onScroll && onScroll()\r\n}\r\n\r\n/* 触发上拉加载 */\r\nMeScroll.prototype.triggerUpScroll = function(isCheck) {\r\n\tif (!this.isUpScrolling && this.optUp.use && this.optUp.callback) {\r\n\t\t// 是否校验在底部; 默认不校验\r\n\t\tif (isCheck === true) {\r\n\t\t\tlet canUp = false;\r\n\t\t\t// 还有下一页 && 没有锁定 && 不在下拉中\r\n\t\t\tif (this.optUp.hasNext && !this.optUp.isLock && !this.isDownScrolling) {\r\n\t\t\t\tif (this.getScrollBottom() <= this.optUp.offset) { // 到底部\r\n\t\t\t\t\tcanUp = true; // 标记可上拉\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (canUp === false) return;\r\n\t\t}\r\n\t\tthis.showUpScroll(); // 上拉加载中...\r\n\t\tthis.optUp.page.num++; // 预先加一页,如果失败则减回\r\n\t\tthis.isUpAutoLoad = true; // 标记上拉已经自动执行过,避免初始化时多次触发上拉回调\r\n\t\tthis.num = this.optUp.page.num; // 把最新的页数赋值在mescroll上,避免对page的影响\r\n\t\tthis.size = this.optUp.page.size; // 把最新的页码赋值在mescroll上,避免对page的影响\r\n\t\tthis.time = this.optUp.page.time; // 把最新的页码赋值在mescroll上,避免对page的影响\r\n\t\tthis.optUp.callback(this); // 执行回调,联网加载数据\r\n\t}\r\n}\r\n\r\n/* 显示上拉加载中 */\r\nMeScroll.prototype.showUpScroll = function() {\r\n\tthis.isUpScrolling = true; // 标记上拉加载中\r\n\tthis.optUp.showLoading && this.optUp.showLoading(this); // 回调\r\n}\r\n\r\n/* 显示上拉无更多数据 */\r\nMeScroll.prototype.showNoMore = function() {\r\n\tthis.optUp.hasNext = false; // 标记无更多数据\r\n\tthis.optUp.showNoMore && this.optUp.showNoMore(this); // 回调\r\n}\r\n\r\n/* 隐藏上拉区域**/\r\nMeScroll.prototype.hideUpScroll = function() {\r\n\tthis.optUp.hideUpScroll && this.optUp.hideUpScroll(this); // 回调\r\n}\r\n\r\n/* 结束上拉加载 */\r\nMeScroll.prototype.endUpScroll = function(isShowNoMore) {\r\n\tif (isShowNoMore != null) { // isShowNoMore=null,不处理下拉状态,下拉刷新的时候调用\r\n\t\tif (isShowNoMore) {\r\n\t\t\tthis.showNoMore(); // isShowNoMore=true,显示无更多数据\r\n\t\t} else {\r\n\t\t\tthis.hideUpScroll(); // isShowNoMore=false,隐藏上拉加载\r\n\t\t}\r\n\t}\r\n\tthis.isUpScrolling = false; // 标记结束上拉加载\r\n}\r\n\r\n/* 重置上拉加载列表为第一页\r\n *isShowLoading 是否显示进度布局;\r\n * 1.默认null,不传参,则显示上拉加载的进度布局\r\n * 2.传参true, 则显示下拉刷新的进度布局\r\n * 3.传参false,则不显示上拉和下拉的进度 (常用于静默更新列表数据)\r\n */\r\nMeScroll.prototype.resetUpScroll = function(isShowLoading) {\r\n\tif (this.optUp && this.optUp.use) {\r\n\t\tlet page = this.optUp.page;\r\n\t\tthis.prePageNum = page.num; // 缓存重置前的页码,加载失败可退回\r\n\t\tthis.prePageTime = page.time; // 缓存重置前的时间,加载失败可退回\r\n\t\tpage.num = this.startNum; // 重置为第一页\r\n\t\tpage.time = null; // 重置时间为空\r\n\t\tif (!this.isDownScrolling && isShowLoading !== false) { // 如果不是下拉刷新触发的resetUpScroll并且不配置列表静默更新,则显示进度;\r\n\t\t\tif (isShowLoading == null) {\r\n\t\t\t\tthis.removeEmpty(); // 移除空布局\r\n\t\t\t\tthis.showUpScroll(); // 不传参,默认显示上拉加载的进度布局\r\n\t\t\t} else {\r\n\t\t\t\tthis.showDownScroll(); // 传true,显示下拉刷新的进度布局,不清空列表\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.isUpAutoLoad = true; // 标记上拉已经自动执行过,避免初始化时多次触发上拉回调\r\n\t\tthis.num = page.num; // 把最新的页数赋值在mescroll上,避免对page的影响\r\n\t\tthis.size = page.size; // 把最新的页码赋值在mescroll上,避免对page的影响\r\n\t\tthis.time = page.time; // 把最新的页码赋值在mescroll上,避免对page的影响\r\n\t\tthis.optUp.callback && this.optUp.callback(this); // 执行上拉回调\r\n\t}\r\n}\r\n\r\n/* 设置page.num的值 */\r\nMeScroll.prototype.setPageNum = function(num) {\r\n\tthis.optUp.page.num = num - 1;\r\n}\r\n\r\n/* 设置page.size的值 */\r\nMeScroll.prototype.setPageSize = function(size) {\r\n\tthis.optUp.page.size = size;\r\n}\r\n\r\n/* 联网回调成功,结束下拉刷新和上拉加载\r\n * dataSize: 当前页的数据量(必传)\r\n * totalPage: 总页数(必传)\r\n * systime: 服务器时间 (可空)\r\n */\r\nMeScroll.prototype.endByPage = function(dataSize, totalPage, systime) {\r\n\tlet hasNext;\r\n\tif (this.optUp.use && totalPage != null) hasNext = this.optUp.page.num < totalPage; // 是否还有下一页\r\n\tthis.endSuccess(dataSize, hasNext, systime);\r\n}\r\n\r\n/* 联网回调成功,结束下拉刷新和上拉加载\r\n * dataSize: 当前页的数据量(必传)\r\n * totalSize: 列表所有数据总数量(必传)\r\n * systime: 服务器时间 (可空)\r\n */\r\nMeScroll.prototype.endBySize = function(dataSize, totalSize, systime) {\r\n\tlet hasNext;\r\n\tif (this.optUp.use && totalSize != null) {\r\n\t\tlet loadSize = (this.optUp.page.num - 1) * this.optUp.page.size + dataSize; // 已加载的数据总数\r\n\t\thasNext = loadSize < totalSize; // 是否还有下一页\r\n\t}\r\n\tthis.endSuccess(dataSize, hasNext, systime);\r\n}\r\n\r\n/* 联网回调成功,结束下拉刷新和上拉加载\r\n * dataSize: 当前页的数据个数(不是所有页的数据总和),用于上拉加载判断是否还有下一页.如果不传,则会判断还有下一页\r\n * hasNext: 是否还有下一页,布尔类型;用来解决这个小问题:比如列表共有20条数据,每页加载10条,共2页.如果只根据dataSize判断,则需翻到第三页才会知道无更多数据,如果传了hasNext,则翻到第二页即可显示无更多数据.\r\n * systime: 服务器时间(可空);用来解决这个小问题:当准备翻下一页时,数据库新增了几条记录,此时翻下一页,前面的几条数据会和上一页的重复;这里传入了systime,那么upCallback的page.time就会有值,把page.time传给服务器,让后台过滤新加入的那几条记录\r\n */\r\nMeScroll.prototype.endSuccess = function(dataSize, hasNext, systime) {\r\n\tlet me = this;\r\n\t// 结束下拉刷新\r\n\tif (me.isDownScrolling) me.endDownScroll();\r\n\r\n\t// 结束上拉加载\r\n\tif (me.optUp.use) {\r\n\t\tlet isShowNoMore; // 是否已无更多数据\r\n\t\tif (dataSize != null) {\r\n\t\t\tlet pageNum = me.optUp.page.num; // 当前页码\r\n\t\t\tlet pageSize = me.optUp.page.size; // 每页长度\r\n\t\t\t// 如果是第一页\r\n\t\t\tif (pageNum === 1) {\r\n\t\t\t\tif (systime) me.optUp.page.time = systime; // 设置加载列表数据第一页的时间\r\n\t\t\t}\r\n\t\t\tif (dataSize < pageSize || hasNext === false) {\r\n\t\t\t\t// 返回的数据不满一页时,则说明已无更多数据\r\n\t\t\t\tme.optUp.hasNext = false;\r\n\t\t\t\tif (dataSize === 0 && pageNum === 1) {\r\n\t\t\t\t\t// 如果第一页无任何数据且配置了空布局\r\n\t\t\t\t\tisShowNoMore = false;\r\n\t\t\t\t\tme.showEmpty();\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// 总列表数少于配置的数量,则不显示无更多数据\r\n\t\t\t\t\tlet allDataSize = (pageNum - 1) * pageSize + dataSize;\r\n\t\t\t\t\tif (allDataSize < me.optUp.noMoreSize) {\r\n\t\t\t\t\t\tisShowNoMore = false;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tisShowNoMore = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tme.removeEmpty(); // 移除空布局\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// 还有下一页\r\n\t\t\t\tisShowNoMore = false;\r\n\t\t\t\tme.optUp.hasNext = true;\r\n\t\t\t\tme.removeEmpty(); // 移除空布局\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 隐藏上拉\r\n\t\tme.endUpScroll(isShowNoMore);\r\n\t}\r\n}\r\n\r\n/* 回调失败,结束下拉刷新和上拉加载 */\r\nMeScroll.prototype.endErr = function() {\r\n\t// 结束下拉,回调失败重置回原来的页码和时间\r\n\tif (this.isDownScrolling) {\r\n\t\tlet page = this.optUp.page;\r\n\t\tif (page && this.prePageNum) {\r\n\t\t\tpage.num = this.prePageNum;\r\n\t\t\tpage.time = this.prePageTime;\r\n\t\t}\r\n\t\tthis.endDownScroll();\r\n\t}\r\n\t// 结束上拉,回调失败重置回原来的页码\r\n\tif (this.isUpScrolling) {\r\n\t\tthis.optUp.page.num--;\r\n\t\tthis.endUpScroll(false);\r\n\t}\r\n}\r\n\r\n/* 显示空布局 */\r\nMeScroll.prototype.showEmpty = function() {\r\n\tthis.optUp.empty.use && this.optUp.empty.onShow && this.optUp.empty.onShow(true)\r\n}\r\n\r\n/* 移除空布局 */\r\nMeScroll.prototype.removeEmpty = function() {\r\n\tthis.optUp.empty.use && this.optUp.empty.onShow && this.optUp.empty.onShow(false)\r\n}\r\n\r\n/* 显示回到顶部的按钮 */\r\nMeScroll.prototype.showTopBtn = function() {\r\n\tif (!this.topBtnShow) {\r\n\t\tthis.topBtnShow = true;\r\n\t\tthis.optUp.toTop.onShow && this.optUp.toTop.onShow(true);\r\n\t}\r\n}\r\n\r\n/* 隐藏回到顶部的按钮 */\r\nMeScroll.prototype.hideTopBtn = function() {\r\n\tif (this.topBtnShow) {\r\n\t\tthis.topBtnShow = false;\r\n\t\tthis.optUp.toTop.onShow && this.optUp.toTop.onShow(false);\r\n\t}\r\n}\r\n\r\n/* 获取滚动条的位置 */\r\nMeScroll.prototype.getScrollTop = function() {\r\n\treturn this.scrollTop || 0\r\n}\r\n\r\n/* 记录滚动条的位置 */\r\nMeScroll.prototype.setScrollTop = function(y) {\r\n\tthis.scrollTop = y;\r\n}\r\n\r\n/* 滚动到指定位置 */\r\nMeScroll.prototype.scrollTo = function(y, t) {\r\n\tthis.myScrollTo && this.myScrollTo(y, t) // scrollview需自定义回到顶部方法\r\n}\r\n\r\n/* 自定义scrollTo */\r\nMeScroll.prototype.resetScrollTo = function(myScrollTo) {\r\n\tthis.myScrollTo = myScrollTo\r\n}\r\n\r\n/* 滚动条到底部的距离 */\r\nMeScroll.prototype.getScrollBottom = function() {\r\n\treturn this.getScrollHeight() - this.getClientHeight() - this.getScrollTop()\r\n}\r\n\r\n/* 计步器\r\n star: 开始值\r\n end: 结束值\r\n callback(step,timer): 回调step值,计步器timer,可自行通过window.clearInterval(timer)结束计步器;\r\n t: 计步时长,传0则直接回调end值;不传则默认300ms\r\n rate: 周期;不传则默认30ms计步一次\r\n * */\r\nMeScroll.prototype.getStep = function(star, end, callback, t, rate) {\r\n\tlet diff = end - star; // 差值\r\n\tif (t === 0 || diff === 0) {\r\n\t\tcallback && callback(end);\r\n\t\treturn;\r\n\t}\r\n\tt = t || 300; // 时长 300ms\r\n\trate = rate || 30; // 周期 30ms\r\n\tlet count = t / rate; // 次数\r\n\tlet step = diff / count; // 步长\r\n\tlet i = 0; // 计数\r\n\tlet timer = setInterval(function() {\r\n\t\tif (i < count - 1) {\r\n\t\t\tstar += step;\r\n\t\t\tcallback && callback(star, timer);\r\n\t\t\ti++;\r\n\t\t} else {\r\n\t\t\tcallback && callback(end, timer); // 最后一次直接设置end,避免计算误差\r\n\t\t\tclearInterval(timer);\r\n\t\t}\r\n\t}, rate);\r\n}\r\n\r\n/* 滚动容器的高度 */\r\nMeScroll.prototype.getClientHeight = function(isReal) {\r\n\tlet h = this.clientHeight || 0\r\n\tif (h === 0 && isReal !== true) { // 未获取到容器的高度,可临时取body的高度 (可能会有误差)\r\n\t\th = this.getBodyHeight()\r\n\t}\r\n\treturn h\r\n}\r\nMeScroll.prototype.setClientHeight = function(h) {\r\n\tthis.clientHeight = h;\r\n}\r\n\r\n/* 滚动内容的高度 */\r\nMeScroll.prototype.getScrollHeight = function() {\r\n\treturn this.scrollHeight || 0;\r\n}\r\nMeScroll.prototype.setScrollHeight = function(h) {\r\n\tthis.scrollHeight = h;\r\n}\r\n\r\n/* body的高度 */\r\nMeScroll.prototype.getBodyHeight = function() {\r\n\treturn this.bodyHeight || 0;\r\n}\r\nMeScroll.prototype.setBodyHeight = function(h) {\r\n\tthis.bodyHeight = h;\r\n}\r\n\r\n/* 阻止浏览器默认滚动事件 */\r\nMeScroll.prototype.preventDefault = function(e) {\r\n\t// 小程序不支持e.preventDefault\r\n\t// app的bounce只能通过配置pages.json的style.app-plus.bounce为\"none\"来禁止\r\n\t// cancelable:是否可以被禁用; defaultPrevented:是否已经被禁用\r\n\tif (e && e.cancelable && !e.defaultPrevented) e.preventDefault()\r\n}\r\n\r\n/* 是否允许下拉回弹(橡皮筋效果); true或null为允许; false禁止bounce */\r\nMeScroll.prototype.setBounce = function(isBounce) {\r\n\t// #ifdef H5\r\n\tif (isBounce === false) {\r\n\t\tthis.optUp.isBounce = false; // 禁止\r\n\t\t// 标记当前页使用了mescroll (需延时,确保page已切换)\r\n\t\tsetTimeout(function() {\r\n\t\t\tlet uniPageDom = document.getElementsByTagName('uni-page')[0];\r\n\t\t\tuniPageDom && uniPageDom.setAttribute('use_mescroll', true)\r\n\t\t}, 30);\r\n\t\t// 避免重复添加事件\r\n\t\tif (window.isSetBounce) return;\r\n\t\twindow.isSetBounce = true;\r\n\t\t// 需禁止window的touchmove事件才能有效的阻止bounce\r\n\t\twindow.bounceTouchmove = function(e) {\r\n\t\t\tlet el = e.target;\r\n\t\t\t// 当前touch的元素及父元素是否要拦截touchmove事件\r\n\t\t\tlet isPrevent = true;\r\n\t\t\twhile (el !== document.body && el !== document) {\r\n\t\t\t\tif (el.tagName === 'UNI-PAGE') { // 只扫描当前页\r\n\t\t\t\t\tif (!el.getAttribute('use_mescroll')) {\r\n\t\t\t\t\t\tisPrevent = false; // 如果当前页没有使用mescroll,则不阻止\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tlet cls = el.classList;\r\n\t\t\t\tif (cls) {\r\n\t\t\t\t\tif (cls.contains('mescroll-touch')) { // 采用scroll-view 此处不能过滤mescroll-uni,否则下拉仍然有回弹\r\n\t\t\t\t\t\tisPrevent = false; // mescroll-touch无需拦截touchmove事件\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t} else if (cls.contains('mescroll-touch-x') || cls.contains('mescroll-touch-y')) {\r\n\t\t\t\t\t\t// 如果配置了水平或者垂直滑动\r\n\t\t\t\t\t\tlet curX = e.touches ? e.touches[0].pageX : e.clientX; // 当前第一个手指距离列表顶部的距离x\r\n\t\t\t\t\t\tlet curY = e.touches ? e.touches[0].pageY : e.clientY; // 当前第一个手指距离列表顶部的距离y\r\n\t\t\t\t\t\tif (!this.preWinX) this.preWinX = curX; // 设置上次移动的距离x\r\n\t\t\t\t\t\tif (!this.preWinY) this.preWinY = curY; // 设置上次移动的距离y\r\n\t\t\t\t\t\t// 计算两点之间的角度\r\n\t\t\t\t\t\tlet x = Math.abs(this.preWinX - curX);\r\n\t\t\t\t\t\tlet y = Math.abs(this.preWinY - curY);\r\n\t\t\t\t\t\tlet z = Math.sqrt(x * x + y * y);\r\n\t\t\t\t\t\tthis.preWinX = curX; // 记录本次curX的值\r\n\t\t\t\t\t\tthis.preWinY = curY; // 记录本次curY的值\r\n\t\t\t\t\t\tif (z !== 0) {\r\n\t\t\t\t\t\t\tlet angle = Math.asin(y / z) / Math.PI * 180; // 角度区间 [0,90]\r\n\t\t\t\t\t\t\tif ((angle <= 45 && cls.contains('mescroll-touch-x')) || (angle > 45 && cls.contains('mescroll-touch-y'))) {\r\n\t\t\t\t\t\t\t\tisPrevent = false; // 水平滑动或者垂直滑动,不拦截touchmove事件\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tel = el.parentNode; // 继续检查其父元素\r\n\t\t\t}\r\n\t\t\t// 拦截touchmove事件:是否可以被禁用&&是否已经被禁用 (这里不使用me.preventDefault(e)的方法,因为某些情况下会报找不到方法的异常)\r\n\t\t\tif (isPrevent && e.cancelable && !e.defaultPrevented && typeof e.preventDefault === \"function\") e.preventDefault();\r\n\t\t}\r\n\t\twindow.addEventListener('touchmove', window.bounceTouchmove, {\r\n\t\t\tpassive: false\r\n\t\t});\r\n\t} else {\r\n\t\tthis.optUp.isBounce = true; // 允许\r\n\t\tif (window.bounceTouchmove) {\r\n\t\t\twindow.removeEventListener('touchmove', window.bounceTouchmove);\r\n\t\t\twindow.bounceTouchmove = null;\r\n\t\t\twindow.isSetBounce = false;\r\n\t\t}\r\n\t}\r\n\t// #endif\r\n}\r\n"]}